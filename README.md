# Spectre

[åœ¨çº¿ä½“éªŒ](https://spectreproject.click) (è´¦å·ï¼š`public`/`P@ssw0rd`)

ä¸€ä¸ª Arthas åœ¨çº¿ç®¡ç†å¹³å°

![core-preview](images/spectre-preview.png)

ğŸ“¦: **é›¶ä¾µå…¥æ€§ï¼Œæ— éœ€ä¸ºæœåŠ¡æ·»åŠ é¢å¤–ä¾èµ–è¿›è¡Œé›†æˆ**

ğŸ³: æ”¯æŒè¿æ¥è¿œç¨‹(SSH) Docker å®¹å™¨ä»¥åŠæœ¬åœ°è¿è¡Œçš„ JVM

â˜¸ï¸: Kubernetes é›†ç¾¤ Pod è¿æ¥æ”¯æŒ

ğŸ‘®: æ‹¥æœ‰å®Œæ•´çš„æƒé™ç®¡ç†ï¼Œå…è®¸é™åˆ¶ç”¨æˆ·å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ï¼Œä½¿ç”¨æ›´åŠ æ”¾å¿ƒ

ğŸ’»:  å®Œç¾ç»“åˆ Web ç•Œé¢çš„ä¼˜åŠ¿ï¼Œæä¾›å„ç§åŸç‰ˆå‘½ä»¤çš„å¢å¼ºä»¥åŠæ›´ç²¾ç¾çš„ç•Œé¢

â™¨ï¸: æ”¯æŒè¿è¡Œåœ¨ Jre ç¯å¢ƒçš„ JVM

## å¢å¼ºåŠŸèƒ½

å¢å¼ºåŠŸèƒ½å¯ä»¥åœ¨è¿æ¥åˆ° JVM ååœ¨å·¦ä¾§èœå•é€‰ä¸­(é¡¶éƒ¨é¢„è§ˆå›¾å·¦ä¾§èœå•)ã€‚è¿™äº›åŠŸèƒ½ç”¨äºç®€åŒ–ä¸€äº›åŸºç¡€çš„æ“ä½œï¼š

- Retransformï¼šå…è®¸ç›´æ¥åœ¨ web ç•Œé¢ä¸Šä¼  class æ–‡ä»¶æ›¿æ¢å­—èŠ‚ç 


## æœ¬åœ°éƒ¨ç½²

> [!CAUTION]
> ç›®å‰ä¸ºé¡¹ç›®æœªç»å¹¿æ³›éªŒè¯ï¼Œå¯èƒ½ä¼šæœ‰å®‰å…¨æ¼æ´ï¼Œ**è¯·æš‚æ—¶ä¸è¦è¿æ¥ç”Ÿäº§ç¯å¢ƒä¸­çš„æœåŠ¡å™¨**ï¼ï¼ï¼


æ•°æ®åº“è¦æ±‚ï¼š
- SQLite
- PostgreSQL

æ¨èä½¿ç”¨ docker-compose å¯åŠ¨(ä¸æ¨èä»¥ root ç”¨æˆ·å¯åŠ¨ï¼Œè¯·ä½¿ç”¨ `sudo useradd -m spectre` æ¥åˆ›å»ºä¸€ä¸ªä¸“ç”¨è´¦å·):

```yaml
name: Spectre
services:
  web:
    user: spectre
    environment:
      SPECTRE_HOME: '/home/spectre/data'
    ports:
      - "80:8080"
    volumes:
      - ./application.yaml:/home/spectre/application.yaml
      - ./data:/home/spectre/data
      - ./logs:/home/spectre/logs
    working_dir: /home/spectre
    image: vudsen/spectre:latest
    command:
      - java
      - -Xmx1g
      - -jar
      - spectre.jar
```

é…ç½®æ–‡ä»¶:

```yaml
# application.yaml
spring:
  profiles:
    active: prod
  datasource:
    # ä½¿ç”¨ sqliteï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ PostGresqlï¼Œå·²ç»å†…ç½®äº†é©±åŠ¨
    url: jdbc:sqlite:data/identifier.sqlite
  jpa:
    properties:
      hibernate:
        dialect: org.hibernate.community.dialect.SQLiteDialect
```

åˆå§‹çš„ç”¨æˆ·åå¯†ç ä¸ºï¼š`admin`/`P@ssw0rd`

## ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

#### 1. æ‰‹åŠ¨ä¸Šä¼ å·¥å…·åŒ…

å› ä¸º Spectre åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ä¼šä» GitHub ä¸Šä¸‹è½½å„ç§ä¾èµ–çš„å·¥å…·ï¼Œä¾‹å¦‚ Arthasã€‚

æ‰€ä»¥å¯¹äºå›½å†…ç¯å¢ƒ/ç¦»çº¿ç¯å¢ƒéœ€è¦æ‰‹åŠ¨ä¸Šä¼ å·¥å…·åŒ…(å¦‚æœå¯ä»¥è”ç½‘ï¼Œå¯ä»¥è·³è¿‡è¿™æ­¥ï¼Œå°è¯•è‡ªåŠ¨ä¸‹è½½)ã€‚

é¦–å…ˆç‚¹å‡»å·¦ä¾§èœå• `å·¥å…·é“¾` -> `å·¥å…·`, åœ¨ç¬¬ä¸€æ¬¡éƒ¨ç½²æ—¶ä¼šé»˜è®¤åˆå§‹åŒ–æ‰€æœ‰éœ€è¦çš„å·¥å…·ï¼Œç„¶åæŸ¥çœ‹ `åŒ…ç¼“å­˜çŠ¶æ€` ä¸€åˆ—ï¼š

![pkg-cache](./images/pkg-cache.png)

å¯ä»¥çœ‹åˆ°å€¼ä¸º `false`ï¼Œç‚¹å‡» `false` åï¼Œä¼šå¼¹å‡ºä¸€ä¸ªä¸Šä¼ å¯¹è¯æ¡†ï¼Œç„¶åæ‰‹åŠ¨ä¸‹è½½å¯¹åº”çš„å·¥å…·åŒ…ä¸Šä¼ å³å¯ã€‚

#### 2. åˆ›å»ºè¿è¡ŒèŠ‚ç‚¹

ç‚¹å‡»å·¦ä¾§èœå• `èŠ‚ç‚¹è®¾ç½®` -> `æ–°å»ºè¿è¡ŒèŠ‚ç‚¹`ï¼Œå³å¯è¿›å…¥åˆ°è¿è¡ŒèŠ‚ç‚¹åˆ›å»ºç•Œé¢ã€‚

ä¸€ä¸ªè¿è¡ŒèŠ‚ç‚¹å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šä¸€ä¸ªè¿è¡Œç€å¾ˆå¤š JVM çš„æœåŠ¡å™¨ã€‚

ç›®å‰æ”¯æŒ SSH(ä»…æ”¯æŒ Windows) å’Œ Kubernetesã€‚

#### 3. è¿æ¥ JVM

ç‚¹å‡»å·¦ä¾§ `èŠ‚ç‚¹è®¾ç½®` -> `èŠ‚ç‚¹åˆ—è¡¨`ï¼Œæ‰¾åˆ°åˆšæ‰åˆ›å»ºçš„è¿è¡ŒèŠ‚ç‚¹ï¼Œåœ¨åˆ—è¡¨ä¸­ç‚¹å‡»ä¸€ä¸ªç±»ä¼¼æ’å¤´çš„å›¾æ ‡ï¼š

![runtime-node-list](./images/runtime-node-list.png)

ä¹‹åå°†ä¼šæ˜¾ç¤ºè¯¦ç»†çš„èŠ‚ç‚¹æ ‘ï¼Œè¯¥ç•Œé¢ä¸­æ‰¾åˆ°éœ€è¦è¿æ¥çš„ JVMï¼Œç‚¹å‡»æ’å¤´å›¾æ ‡ï¼Œå³å¯è¿æ¥ï¼š

![runtime-node-tree](./images/runtime-node-tree.png)

è¿æ¥è¿‡ç¨‹å¯èƒ½è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

#### 4. æ‰§è¡Œå‘½ä»¤

è¿æ¥å®Œæˆåï¼Œå°†ä¼šè¿›å…¥å‘½ä»¤æ‰§è¡Œç•Œé¢ï¼š

![spectre-preview](./images/spectre-preview.png)

åœ¨ä¸‹æ–¹è¾“å…¥æ¡†å³å¯è¾“å…¥ Arthas å‘½ä»¤ã€‚


### å…³äº Kubernetes

å¦‚æœè¦è¿æ¥åˆ° Kubernetesï¼Œæ¨èå‚è€ƒ [k8s-full-roles.yaml](./deploy/k8s-full-roles.yaml) ä»¥æä¾›åŸºç¡€æ‰€éœ€æƒé™(`pods/exec` å’Œ `pods` å¯ä»¥é™åˆ¶åˆ°å‘½åç©ºé—´èŒƒå›´)ã€‚


## å¼€å‘éƒ¨ç½²

å¼€å‘å·¥å…·è¦æ±‚ï¼š

- Java: 17
- NodeJs: 20+
- pnpm: 9+

### å¯åŠ¨åç«¯

æä¾› redis é…ç½®åç›´æ¥å¯åŠ¨å³å¯ã€‚

### å¯åŠ¨å‰ç«¯

è¯¦è§å‰ç«¯æ–‡ä»¶å¤¹å†…çš„ [README.md](./spectre-frontend/README.md)
